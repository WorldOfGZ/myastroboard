# üöÄ Release Process

This guide explains how to publish a new version of MyAstroBoard, including creating releases and publishing Docker images.

## üìã Prerequisites

- Write access to the repository
- Git installed locally
- Understanding of [Semantic Versioning](https://semver.org/)

## üè∑Ô∏è Versioning Strategy

MyAstroBoard follows [Semantic Versioning](https://semver.org/):

- **MAJOR** version (x.0.0): Incompatible API changes, breaking changes
- **MINOR** version (0.x.0): New features, backwards-compatible
- **PATCH** version (0.0.x): Bug fixes, backwards-compatible

## üì¶ Release Process

### Step 1: Prepare the Release

1. **Ensure all changes are merged** to the main branch:
   ```bash
   git checkout main
   git pull origin main
   ```

2. **Update the VERSION file**:
   ```bash
   # Edit the VERSION file with the new version number
   echo "0.2.0" > VERSION
   ```

3. **Review and test changes**:
   - Run all tests: `pytest --cov=backend tests/`
   - Build locally: `docker compose build`
   - Test the application thoroughly

4. **Commit the version change**:
   ```bash
   git add VERSION
   git commit -m "Bump version to 0.2.0"
   git push origin main
   ```

### Step 2: Create a Git Tag

Create and push a version tag. The tag **must** follow the format `v*.*.*` (e.g., `v0.2.0`):

```bash
# Create an annotated tag
git tag -a v0.2.0 -m "Release v0.2.0"

# Push the tag to GitHub
git push origin v0.2.0
```

### Step 3: Automated Build and Release

Once you push the tag, the GitHub Actions workflow will automatically:

1. ‚úÖ **Trigger** the `docker-publish.yml` workflow
2. ‚úÖ **Build** the Docker image
3. ‚úÖ **Publish** the image to GitHub Container Registry with multiple tags:
   - `ghcr.io/worldofgz/myastroboard:v0.2.0` (specific version)
   - `ghcr.io/worldofgz/myastroboard:v0.2` (minor version)
   - `ghcr.io/worldofgz/myastroboard:v0` (major version)
   - `ghcr.io/worldofgz/myastroboard:latest` (if on main branch)
4. ‚úÖ **Create** a GitHub Release with auto-generated release notes

### Step 4: Verify the Release

1. **Check the GitHub Actions workflow**:
   - Go to: `https://github.com/WorldOfGZ/myastroboard/actions`
   - Verify the "Build and Publish Docker Image" workflow completed successfully

2. **Verify the Docker image**:
   ```bash
   docker pull ghcr.io/worldofgz/myastroboard:v0.2.0
   docker images | grep myastroboard
   ```

3. **Check the GitHub Release**:
   - Go to: `https://github.com/WorldOfGZ/myastroboard/releases`
   - Verify the new release appears with auto-generated notes

4. **Test the published image**:
   ```bash
   # Pull and run the new version
   docker run --rm ghcr.io/worldofgz/myastroboard:v0.2.0 cat /app/VERSION
   ```

## üîÑ Manual Workflow Trigger

You can also manually trigger the Docker build workflow without creating a release:

1. Go to: `https://github.com/WorldOfGZ/myastroboard/actions`
2. Select "Build and Publish Docker Image"
3. Click "Run workflow"
4. Select the branch and click "Run workflow"

> [!NOTE]
> Manual triggers will build and publish the Docker image but **will not** create a GitHub release.

## üìù Release Notes Best Practices

While release notes are auto-generated from commit messages and pull requests, you can edit them after creation:

1. Go to the release page
2. Click "Edit release"
3. Enhance the auto-generated notes with:
   - **Highlights**: Major new features or important changes
   - **Breaking Changes**: Any backwards-incompatible changes
   - **Migration Guide**: If users need to take action
   - **Known Issues**: Any known bugs or limitations
   - **Contributors**: Acknowledge contributors

Example structure:
```markdown
## üéâ Highlights
- Added new feature X
- Improved performance of Y

## üîß Changes
- Fixed bug in Z
- Updated dependency A to version B

## ‚ö†Ô∏è Breaking Changes
- Configuration format changed (see migration guide below)

## üìñ Migration Guide
If upgrading from v0.1.x, you need to:
1. Update your docker-compose.yml
2. Run migration script

## üôè Contributors
Thanks to @username for their contribution!
```

## üêõ Hotfix Releases

For critical bug fixes that need immediate release:

1. **Create a hotfix branch**:
   ```bash
   git checkout -b hotfix/v0.2.1 v0.2.0
   ```

2. **Apply the fix**:
   ```bash
   # Make your changes
   git add .
   git commit -m "Fix critical bug in X"
   ```

3. **Update VERSION**:
   ```bash
   echo "0.2.1" > VERSION
   git add VERSION
   git commit -m "Bump version to 0.2.1"
   ```

4. **Merge to main**:
   ```bash
   git checkout main
   git merge hotfix/v0.2.1
   git push origin main
   ```

5. **Tag and release**:
   ```bash
   git tag -a v0.2.1 -m "Hotfix v0.2.1"
   git push origin v0.2.1
   ```

## üîô Rolling Back a Release

If a release has issues:

### Option 1: Delete the Release (Recommended for Early Mistakes)
```bash
# Delete the tag locally
git tag -d v0.2.0

# Delete the tag remotely
git push origin :refs/tags/v0.2.0

# Delete the release on GitHub (do this manually via GitHub UI)
```

### Option 2: Create a New Patch Release
If users have already pulled the image, create a fix:
```bash
# Fix the issue
echo "0.2.1" > VERSION
git add VERSION
git commit -m "Fix issue in v0.2.0"
git push origin main

# Create new release
git tag -a v0.2.1 -m "Fix for v0.2.0"
git push origin v0.2.1
```

## üìö Additional Resources

- [Semantic Versioning](https://semver.org/)
- [GitHub Releases Documentation](https://docs.github.com/en/repositories/releasing-projects-on-github)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Docker Tags Best Practices](https://docs.docker.com/engine/reference/commandline/tag/)

## ‚ùì Troubleshooting

### Workflow Fails to Trigger
- Ensure the tag follows the `v*.*.*` format
- Check that you pushed the tag: `git push origin v0.2.0`
- Verify GitHub Actions is enabled in repository settings

### Docker Build Fails
- Check the workflow logs in GitHub Actions
- Verify the Dockerfile is valid
- Ensure all dependencies are available

### Release Not Created
- Check that the tag starts with `v` (e.g., `v0.2.0`)
- Verify the workflow has `contents: write` permission
- Check GitHub Actions logs for errors

### Image Not Published
- Verify GitHub Packages is enabled
- Check repository permissions for GITHUB_TOKEN
- Ensure the workflow completed successfully
